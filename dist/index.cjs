var e=require("react");function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},t.apply(this,arguments)}var r={selector:void 0,manipulate:void 0,method:"GET",headers:void 0,body:void 0,isDebuggerActivated:!1,cacheTimeout:0},o=null,n=function(e,t,r,o){void 0===e&&(e=""),void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===o&&(o=null),r?t&&console.error("[USE_QUERY]: "+e+" - "+(new Date).toLocaleTimeString(),o):t&&console.log("[USE_QUERY]: "+e+" - "+(new Date).toLocaleTimeString())},a=function(e){var t=Object.keys(r),o=Object.keys(e).filter(function(e){return!t.includes(e)});return void 0!==e.selector&&"string"!=typeof e.selector?(n("Validation error for `options.selector`",isDebuggerActivated,!0,new Error("Selector must be a string. It should contains key value to select from result object.")),!1):void 0===e.method||"string"==typeof e.method&&-1!==["GET","POST","PUT","PATCH","DELETE"].indexOf(e.method.toUpperCase())?void 0!==e.headers&&"object"!=typeof e.headers&&Array.isArray(e.headers)?(n("Validation error for `options.headers`",isDebuggerActivated,!0,new Error("Headers must be an object. It should contains request headers key value.")),!1):void 0!==e.isDebuggerActivated&&"boolean"!=typeof e.isDebuggerActivated&&Array.isArray(e.headers)?(n("Validation error for `options.isDebuggerActivated`",!0,!0,new Error("isDebuggerActivated must be a boolean. It should be activated if you need to debug all process.")),!1):void 0!==e.manipulate&&"function"!=typeof e.manipulate?(n("Validation error for `options.manipulate`",!0,!0,new Error("manipulate must be a function. It rappresent the funcion to manipulate data before saving on state.")),!1):void 0!==e.cacheTimeout&&"number"!=typeof e.cacheTimeout?(n("Validation error for `options.cacheTimeout`",!0,!0,new Error("cacheTimeout must be a number. It rappresent the timeout to remove cached data from memory in milliseconds.")),!1):!(o.length>0&&(n("Validation error",!0,!0,new Error("Found not valid option"+(o.length>1?"s":"")+': "'+o.join('", "')+'".')),1)):(n("Validation error for `options.method`",isDebuggerActivated,!0,new Error('Method must be a string. It should be one of "GET", "POST", "PUT", "PATCH", "DELETE".')),!1)},i=function(e,t){e.cacheTimeout&&e.cacheTimeout>0&&(n("Cache clear timeout start: "+e.cacheTimeout/1e3+" seconds.",e.isDebuggerActivated),clearTimeout(o),o=setTimeout(function(){t.current={},n("Cache cleared",e.isDebuggerActivated)},e.cacheTimeout))},u=e.createContext(null),c=function(){return e.useContext(u)};exports.QueryProvider=function(t){var r=t.children,o=e.useState(null);return h(u.Provider,{value:[o[0],o[1]]},r)},exports.useQuery=function(o,u){void 0===u&&(u=t({},r));var s=t({},r,u),d=s.selector,l=s.manipulate,f=s.method,h=s.headers,v=s.body,m=s.isDebuggerActivated;a(t({},r,u));var p=e.useRef({}),g=c(),b=g[0],y=g[1],T=e.useState(null),E=T[0],A=T[1],D=e.useState(!1),w=D[0],P=D[1],j=function(){try{if(n("Fetching data...",m),E&&A(null),w||P(!0),p.current[o])return n("Get data from cache, no need a new request",m),"function"==typeof l&&n("Manipulate data before saving",m),y(p.current[o]),i(u,p),P(!1),Promise.resolve();var e=function(e,t){try{var r=e()}catch(e){return t(!0,e)}return r&&r.then?r.then(t.bind(null,!1),t.bind(null,!0)):t(!1,r)}(function(){return function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(function(){return n("No data found in cache, proceed to do a new request...",m),Promise.resolve(fetch(o,{method:f,headers:h,data:v})).then(function(e){return Promise.resolve(e.json()).then(function(t){if(e.ok){var r=d?t[d]:t;"function"==typeof l&&n("Manipulate data before saving",m),y("function"==typeof l?l(r):r),n("Request done",m),p.current[o]="function"==typeof l?l(r):r,i(u,p),n('New data saved on cache for: "'+o+'"',m)}else A(t),n("An error occurred",m,!0,t)})})},function(e){A(e),n("An error occurred",m,!0,e)})},function(e,t){if(P(!1),n("Data seatled, process done",m),e)throw t;return t});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};return e.useEffect(function(){j()},[o]),{data:b,error:E,loading:w,updateData:y,refresh:j,cache:{get:function(e){return e?p.current[e]:p.current},has:function(e){return p.current[e]},clear:function(){p.current={},n("Cache cleared",m)}}}},exports.useQueryContext=c;
//# sourceMappingURL=index.cjs.map
