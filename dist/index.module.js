import{createContext as e,useState as t,useContext as r,useRef as o,useEffect as n}from"react";function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},a.apply(this,arguments)}var i={selector:void 0,manipulate:void 0,method:"GET",headers:void 0,body:void 0,isDebuggerActivated:!1,cacheTimeout:0},c=null,u=function(e,t,r,o){void 0===e&&(e=""),void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===o&&(o=null),r?t&&console.error("[USE_QUERY]: "+e+" - "+(new Date).toLocaleTimeString(),o):t&&console.log("[USE_QUERY]: "+e+" - "+(new Date).toLocaleTimeString())},s=function(e){var t=Object.keys(i),r=Object.keys(e).filter(function(e){return!t.includes(e)});return void 0!==e.selector&&"string"!=typeof e.selector?(u("Validation error for `options.selector`",isDebuggerActivated,!0,new Error("Selector must be a string. It should contains key value to select from result object.")),!1):void 0===e.method||"string"==typeof e.method&&-1!==["GET","POST","PUT","PATCH","DELETE"].indexOf(e.method.toUpperCase())?void 0!==e.headers&&"object"!=typeof e.headers&&Array.isArray(e.headers)?(u("Validation error for `options.headers`",isDebuggerActivated,!0,new Error("Headers must be an object. It should contains request headers key value.")),!1):void 0!==e.isDebuggerActivated&&"boolean"!=typeof e.isDebuggerActivated&&Array.isArray(e.headers)?(u("Validation error for `options.isDebuggerActivated`",!0,!0,new Error("isDebuggerActivated must be a boolean. It should be activated if you need to debug all process.")),!1):void 0!==e.manipulate&&"function"!=typeof e.manipulate?(u("Validation error for `options.manipulate`",!0,!0,new Error("manipulate must be a function. It rappresent the funcion to manipulate data before saving on state.")),!1):void 0!==e.cacheTimeout&&"number"!=typeof e.cacheTimeout?(u("Validation error for `options.cacheTimeout`",!0,!0,new Error("cacheTimeout must be a number. It rappresent the timeout to remove cached data from memory in milliseconds.")),!1):!(r.length>0&&(u("Validation error",!0,!0,new Error("Found not valid option"+(r.length>1?"s":"")+': "'+r.join('", "')+'".')),1)):(u("Validation error for `options.method`",isDebuggerActivated,!0,new Error('Method must be a string. It should be one of "GET", "POST", "PUT", "PATCH", "DELETE".')),!1)},d=function(e,t){e.cacheTimeout&&e.cacheTimeout>0&&(u("Cache clear timeout start: "+e.cacheTimeout/1e3+" seconds.",e.isDebuggerActivated),clearTimeout(c),c=setTimeout(function(){t.current={},u("Cache cleared",e.isDebuggerActivated)},e.cacheTimeout))},l=e(null),f=function(e){var r=e.children,o=t(null);return h(l.Provider,{value:[o[0],o[1]]},r)},v=function(){return r(l)},m=function(e,r){void 0===r&&(r=a({},i));var c=a({},i,r),l=c.selector,f=c.manipulate,h=c.method,m=c.headers,p=c.body,g=c.isDebuggerActivated;s(a({},i,r));var b=o({}),y=v(),T=y[0],E=y[1],A=t(null),D=A[0],w=A[1],P=t(!1),j=P[0],O=P[1],S=function(){try{if(u("Fetching data...",g),D&&w(null),j||O(!0),b.current[e])return u("Get data from cache, no need a new request",g),"function"==typeof f&&u("Manipulate data before saving",g),E(b.current[e]),d(r,b),O(!1),Promise.resolve();var t=function(e,t){try{var r=e()}catch(e){return t(!0,e)}return r&&r.then?r.then(t.bind(null,!1),t.bind(null,!0)):t(!1,r)}(function(){return function(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(function(){return u("No data found in cache, proceed to do a new request...",g),Promise.resolve(fetch(e,{method:h,headers:m,data:p})).then(function(t){return Promise.resolve(t.json()).then(function(o){if(t.ok){var n=l?o[l]:o;"function"==typeof f&&u("Manipulate data before saving",g),E("function"==typeof f?f(n):n),u("Request done",g),b.current[e]="function"==typeof f?f(n):n,d(r,b),u('New data saved on cache for: "'+e+'"',g)}else w(o),u("An error occurred",g,!0,o)})})},function(e){w(e),u("An error occurred",g,!0,e)})},function(e,t){if(O(!1),u("Data seatled, process done",g),e)throw t;return t});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};return n(function(){S()},[e]),{data:T,error:D,loading:j,updateData:E,refresh:S,cache:{get:function(e){return e?b.current[e]:b.current},has:function(e){return b.current[e]},clear:function(){b.current={},u("Cache cleared",g)}}}};export{f as QueryProvider,m as useQuery,v as useQueryContext};
//# sourceMappingURL=index.module.js.map
